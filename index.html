<!doctype html>
<html lang="ur" dir="rtl">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مدرسة — Madrasa Resources</title>
  <link rel="icon" type="image/png" href="assets/img/logo.png" />
  <link href="https://cdn.jsdelivr.net/gh/shakesvision/MehrNastaleeq/font.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body class="bg-gray-50 text-gray-900" x-data="app()" x-init="init()" :class="{ 'overflow-hidden': sidebarOpen }">
  <div class="min-h-screen flex">
    <!-- Sidebar -->
    <aside class="w-72 bg-white border-l h-screen fixed right-0 top-0 hidden lg:block overflow-y-auto"
      id="sidebar-desktop">
      <div class="logo-and-heading p-4 border-b text-center">
        <img src="assets/img/logo.png" alt="madras-logo-shakeeb" class="m-auto w-100 h-100 rounded-full shadow-md"
          width="100" height="100" />
        <div class="p-4">
          <h1 class="text-2xl font-semibold">مدرسة</h1>
          <p class="text-sm text-gray-600">وسائلِ تعلیم و نوٹس</p>
        </div>
      </div>
      <nav class="p-4 space-y-1" id="sidebar-list">
        <!-- dynamic items -->
      </nav>
      <footer>
        <p class="p-4 text-sm text-gray-400">© 2025 از <a href="https://ur.shakeeb.in"></a> شکیبؔ احمد</p>
      </footer>
    </aside>

    <!-- Mobile sidebar (drawer) -->
    <div x-show="sidebarOpen" x-transition class="fixed inset-0 bg-black/30 z-40 lg:hidden" @click="sidebarOpen=false">
    </div>
    <aside x-show="sidebarOpen" x-transition
      class="fixed top-0 right-0 h-full w-72 bg-white z-50 overflow-y-auto lg:hidden">
      <div class="p-4 border-b flex items-center justify-between">
        <div class="sidebar-heading-with-logo flex gap-2 items-center">
          <img src="assets/img/logo.png" alt="madras-logo-shakeeb" class="w-12 h-12 rounded-full shadow-md mr-3"
            width="50" />
          <div>
            <h1 class="text-xl font-semibold">مدرسة</h1>
            <p class="text-sm text-gray-600">وسائلِ تعلیم</p>
          </div>
        </div>
        <button @click="sidebarOpen=false" class="px-2 py-1">✕</button>
      </div>
      <nav class="p-4 space-y-1" id="sidebar-list-mobile">
        <!-- dynamic items -->
      </nav>
    </aside>

    <!-- Main content -->
    <main class="flex-1 lg:mr-72 p-6">
      <header class="flex items-center justify-between mb-4">
        <div>
          <button class="lg:hidden px-3 py-2 bg-gray-100 rounded" @click="sidebarOpen = true">☰</button>
        </div>
        <div class="text-right">
          <p class="text-sm text-gray-600"> دروس و وسائلِ مدرسہ از شکیبـؔ احمد
          </p>
        </div>
      </header>

      <div id="content-area" class="transition-opacity" x-html="contentHtml"></div>
    </main>
  </div>

  <script>
    function app() {
      return {
        sidebarOpen: false,
        contentHtml: '<h2 class="text-2xl font-bold mb-3">لوڈ ہو رہا ہے...</h2>',
        activeKey: null, // e.g. "year3" or "resource:global"
        init() {
          // load sidebar
          fetch('data/global.json').then(r => r.json()).then(data => {
            this.renderSidebar(data.sidebar);
            // restore last visited
            const last = localStorage.getItem('mr_last');
            if (last) {
              this.loadByKey(last);
            } else {
              // default to year3
              this.loadByKey('year3');
            }
          }).catch(err => {
            console.error(err);
          });
        },
        renderSidebar(items) {
          const container = document.getElementById('sidebar-list');
          const mobile = document.getElementById('sidebar-list-mobile');
          container.innerHTML = '';
          mobile.innerHTML = '';
          items.forEach(it => {
            const el = document.createElement('a');
            el.href = '#';
            el.className = 'block p-2 rounded hover:bg-gray-100 text-right';
            el.innerText = it.label;
            el.setAttribute('data-key', it.key);
            el.addEventListener('click', (e) => {
              e.preventDefault();
              this.loadByKey(it.key);
              this.highlight(it.key);
              this.sidebarOpen = false;
            });
            const elm = el.cloneNode(true);
            elm.addEventListener('click', (e) => {
              e.preventDefault();
              this.loadByKey(it.key);
              this.highlight(it.key);
              this.sidebarOpen = false;
            });
            container.appendChild(el);
            mobile.appendChild(elm);
          });
        },
        highlight(key) {
          this.activeKey = key;
          localStorage.setItem('mr_last', key);
          // update classes
          document.querySelectorAll('#sidebar-list a, #sidebar-list-mobile a').forEach(a => {
            if (a.getAttribute('data-key') === key) {
              a.classList.add('bg-indigo-600', 'text-white');
              a.classList.remove('text-gray-900');
            } else {
              a.classList.remove('bg-indigo-600', 'text-white');
              a.classList.add('text-gray-900');
            }
          });
        },
        async loadByKey(key) {
          // keys: 'year3' or 'resource:global' etc.
          this.highlight(key);
          if (key.startsWith('year:')) {
            const file = key.split(':')[1]; // e.g. year3.json
            const res = await fetch('data/' + file);
            const data = await res.json();
            // render year with tabs
            this.renderYear(data, file.replace('.json', ''));
          } else if (key.startsWith('resource:')) {
            const file = key.split(':')[1];
            const r = await fetch('data/' + file);
            const text = await r.text();
            this.contentHtml = text;
          } else if (key === 'year3') {
            // load year3 by default
            const res = await fetch('data/year3.json');
            const data = await res.json();
            this.renderYear(data, 'year3');
          } else {
            // fallback
            this.contentHtml = '<p>صبح و سہ</p>';
          }
        },
        async renderYear(data, yearKey) {
          const subjects = data.subjects || [];
          // build tabs
          let tabs = '<div class="flex gap-2 mb-4 flex-wrap">';
          subjects.forEach((s, i) => {
            tabs += `<button onclick="window.mr_showSubject(${i}, '${yearKey}')" class="tab-btn px-3 py-1 rounded ${i === 0 ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-800'}">${s.name}</button>`;
          });
          tabs += '</div>';
          let container = `<h2 class="text-2xl font-bold mb-2">سال: ${yearKey.replace('year', '')}</h2>${tabs}<div id="subject-content" class="bg-white p-4 rounded-lg shadow-sm"></div>`;
          this.contentHtml = container;
          // show first subject
          setTimeout(() => window.mr_showSubject(0, yearKey), 50);
        }
      }
    }

    // expose global function for tab clicks
    window.mr_showSubject = async function (index, yearKey) {
      const res = await fetch('data/' + yearKey + '.json');
      const data = await res.json();
      const subject = data.subjects[index];
      const content = document.getElementById('subject-content');
      // load subject html
      try {
        const r = await fetch('data/' + yearKey + '/' + subject.slug + '/' + subject.slug + '.html');
        const html = await r.text();
        content.innerHTML = html;
      } catch (e) {
        content.innerHTML = '<p class="text-gray-500">مضمون دستیاب نہیں۔</p>';
      }
      // adjust tab active classes
      document.querySelectorAll('.tab-btn').forEach((btn, i) => {
        if (i === index) {
          btn.classList.add('bg-indigo-600', 'text-white');
          btn.classList.remove('bg-gray-200', 'text-gray-800');
        } else {
          btn.classList.remove('bg-indigo-600', 'text-white');
          btn.classList.add('bg-gray-200', 'text-gray-800');
        }
      });
    }
  </script>
</body>

</html>